/*******************************************************************************
 * Dropdown
 *
 * Select/dropdown component styling.
 * Uses Build Canada design system colors.
 ******************************************************************************/

@import "dropdown-icons";

$grapher-dropdown-hover-fill: $gray-10;
$grapher-dropdown-active-fill: $auburn-100;
$grapher-dropdown-selected-fill: $auburn-200;

.grapher-dropdown {
    position: relative;
    font: 400 13px/16px $sans-serif-font-stack;

    // Fixes a Firefox bug where long labels would cause the dropdown to resize
    // See: https://github.com/JedWatson/react-select/issues/5170
    display: grid;
    grid-template-columns: minmax(0, 1fr);

    .clear-indicator {
        padding-right: 10px;
        position: absolute;
        right: 29px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        border-right: 1px solid $gray-20;
        background: none;
        display: flex;
        align-items: center;
        z-index: 1;
        height: calc(100% - 12px);

        &::after {
            content: " ";
            background: url($clear) no-repeat center;
            width: 12px;
            height: 12px;
        }

        &:hover::after {
            background-image: url($clear-hover);
        }
    }

    .control {
        min-height: auto;
        font: 400 13px/16px $sans-serif-font-stack;
        letter-spacing: 0.01em;
        text-align: left;
        display: flex;
        align-items: center;
        border: 1px solid $gray-20;
        border-radius: 0;
        padding: 8px 12px;
        color: $charcoal;
        background: $white;
        cursor: pointer;
        position: relative;
        width: 100%;
        transition: all 150ms ease;

        &:focus-visible {
            outline: 2px solid $auburn;
            outline-offset: 2px;
        }

        &:hover {
            background: $grapher-dropdown-hover-fill;
        }

        &[data-disabled] {
            opacity: 0.5;
            cursor: not-allowed;
            background: $gray-10;
        }

        &:after {
            content: " ";
            background: url($menu-caret-down) no-repeat center;
            width: 16px;
            height: 16px;
            margin-left: auto;
            flex-shrink: 0;
        }

        &.loading:after {
            opacity: 0.5;
        }

        &[data-pressed] {
            border-color: $auburn-500;
            background: $auburn-50;
            &:after {
                background: url($menu-caret-up) no-repeat center;
            }
        }

        .label {
            color: $gray-60;

            svg {
                margin-left: 1px;
                margin-right: 5px;
            }
        }
    }

    .select-value {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 100%;

        &[data-placeholder] {
            color: $gray-50;
            white-space: nowrap;
        }
    }
}

.grapher-dropdown-listbox {
    max-height: 400px;
    overflow-y: auto;

    &:focus-visible {
        outline: none;
    }
}

.grapher-dropdown-menu {
    $option-checkmark: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOSIgdmlld0JveD0iMCAwIDEyIDkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0xMS4wMTU2IDAuOTg0Mzc1QzExLjMyMDMgMS4yNjU2MiAxMS4zMjAzIDEuNzU3ODEgMTEuMDE1NiAyLjAzOTA2TDUuMDE1NjIgOC4wMzkwNkM0LjczNDM4IDguMzQzNzUgNC4yNDIxOSA4LjM0Mzc1IDMuOTYwOTQgOC4wMzkwNkwwLjk2MDkzOCA1LjAzOTA2QzAuNjU2MjUgNC43NTc4MSAwLjY1NjI1IDQuMjY1NjIgMC45NjA5MzggMy45ODQzOEMxLjI0MjE5IDMuNjc5NjkgMS43MzQzOCAzLjY3OTY5IDIuMDE1NjIgMy45ODQzOEw0LjQ3NjU2IDYuNDQ1MzFMOS45NjA5NCAwLjk4NDM3NUMxMC4yNDIyIDAuNjc5Njg4IDEwLjczNDQgMC42Nzk2ODggMTEuMDE1NiAwLjk4NDM3NVoiIGZpbGw9IiMxZjVmN2YiLz4KPC9zdmc+";
    $option-checkmark-width: 12px;
    font: 400 13px/16px $sans-serif-font-stack;

    margin-top: 4px;
    border-radius: 0;
    background: $white;
    box-shadow: 0px 4px 20px 0px rgba(39, 39, 39, 0.15);
    z-index: $zindex-controls-popup;
    color: $charcoal;
    width: var(--trigger-width);
    overflow-y: hidden;
    border: 1px solid $gray-20;

    .group-heading {
        @include grapher_h5-black-caps;
        font-size: 11px;
        color: $gray-60;
        margin: 12px 12px 4px 12px;
        font-weight: 700;
        letter-spacing: 0.05em;
    }

    .group + .group .group-heading {
        margin-top: 8px;
        padding: 12px 0 4px 0;
        border-top: 1px solid $gray-10;
    }

    .option {
        padding: 10px calc(16px + $option-checkmark-width + 2px) 10px 16px;
        cursor: pointer;
        transition: all 100ms ease;

        &[data-hovered],
        &[data-focused] {
            background: $grapher-dropdown-hover-fill;
        }

        &:focus-visible {
            outline: none !important;
        }

        &[data-pressed] {
            color: $auburn;
            background: $grapher-dropdown-active-fill;
        }

        &[data-selected] {
            position: relative;
            color: $auburn;
            background: $grapher-dropdown-active-fill;
            font-weight: 500;

            &:hover {
                background: $grapher-dropdown-selected-fill;
            }

            &:after {
                content: " ";
                background: url($option-checkmark) no-repeat;
                width: $option-checkmark-width;
                height: 9px;
                position: absolute;
                right: 16px;
                top: 50%;
                transform: translateY(-50%);
            }
        }

        .detail {
            color: $gray-60;
            font-size: 12px;
        }

        &[data-selected] .detail {
            color: $auburn-700;
        }
    }
}

/*******************************************************************************
 * Dropdown Search
 ******************************************************************************/

.grapher-dropdown-search {
    display: flex;
    align-items: center;
    margin: 8px;
    border: 1px solid $gray-20;
    border-radius: 0;
    height: 36px;
    background: $white;
    transition: all 150ms ease;

    &:focus-within {
        border-color: $auburn-500;
    }
}

.grapher-dropdown-search-input {
    flex: 1;
    min-width: 0;
    border: none;
    outline: 0;
    font: 400 13px/16px $sans-serif-font-stack;
    color: $charcoal;
    background: transparent;
    padding: 8px;

    &:focus-visible {
        outline: none;
    }

    &::placeholder {
        color: $gray-50;
    }
}

.grapher-dropdown-search-icon {
    $magnifying-glass: "data:image/svg+xml;base64,PHN2ZwogICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICAgdmlld0JveD0iMCAwIDUxMiA1MTIiCj4KICA8cGF0aAogICAgZD0iTTQxNiAyMDhjMCA0NS45LTE0LjkgODguMy00MCAxMjIuN0w1MDIuNiA0NTcuNGMxMi41IDEyLjUgMTIuNSAzMi44IDAgNDUuM3MtMzIuOCAxMi41LTQ1LjMgMEwzMzAuNyAzNzZjLTM0LjQgMjUuMi03Ni44IDQwLTEyMi43IDQwQzkzLjEgNDE2IDAgMzIyLjkgMCAyMDhTOTMuMSAwIDIwOCAwUzQxNiA5My4xIDQxNiAyMDh6TTIwOCAzNTJhMTQ0IDE0NCAwIDEgMCAwLTI4OCAxNDQgMTQ0IDAgMSAwIDAgMjg4eiIKICAgIGZpbGw9IiM3MzczNzMiCiAgLz4KPC9zdmc+Cg==";
    margin-left: 10px;
    width: 14px;
    height: 14px;
    background: url($magnifying-glass) no-repeat center;
    background-size: contain;
    flex-shrink: 0;
}

.grapher-dropdown-search-reset {
    margin-right: 10px;
    border: none;
    background: none;
    padding: 4px;
    cursor: pointer;
    color: $gray-50;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 150ms ease;

    &:hover {
        color: $charcoal;
    }
}

.grapher-dropdown-search[data-empty] .grapher-dropdown-search-reset {
    visibility: hidden;
}
